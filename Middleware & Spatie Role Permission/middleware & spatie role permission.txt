Laravel Middleware & Role-Permission Cheat Sheet
1. Middleware – Overview

Definition:

Middleware filters HTTP requests entering your application.

Acts before or after a request reaches the controller.

Common Uses:

Authentication

Authorization

Logging requests

CORS headers

Rate limiting

Types:

Global Middleware – Runs on every request (e.g., CheckForMaintenanceMode)

Route Middleware – Assigned to specific routes (e.g., auth, throttle)

Conceptual Flow:

[Request] → [Global Middleware] → [Route Middleware] → [Controller] → [Response]

2. Authentication Middleware

Purpose: Ensure users are logged in before accessing certain routes.

Common Middleware:

auth → Requires user authentication

guest → Redirects authenticated users (for login/register pages)

auth:sanctum → API token authentication with Sanctum

Notes:

Can use guards (auth:api, auth:web) to protect different user types

Middleware can be applied in routes or controller constructors

Works with Laravel’s Auth system (users table, sessions, tokens)

3. Authorization & Role-Permission

Definition: Restrict access based on user roles or permissions.

A. Built-in Laravel Gates & Policies

Gate: Closure-based access control

Policy: Class-based access control linked to a model

Usage Concept:

$user->can('edit-post')

@can('edit', $post) in Blade templates

B. Spatie Laravel Role-Permission Package

Purpose: Advanced role-based access control (RBAC)

Key Concepts:

Roles: Group of permissions (e.g., Admin, Editor)

Permissions: Specific abilities (e.g., create-post, delete-user)

Assigning Roles/Permissions: Users can have multiple roles & permissions

Database Structure (Spatie):

roles → stores role names

permissions → stores permission names

model_has_roles → links user to roles

role_has_permissions → links roles to permissions

model_has_permissions → optional direct permission assignment

Middleware Provided:

role:<role> → restrict route to specific role(s)

permission:<permission> → restrict route to specific permission(s)

role_or_permission:<role|permission> → either/or access

Usage Concept:

Route::get('/admin', middleware: ['role:admin']);
Route::post('/post', middleware: ['permission:create-post']);


Advantages:

Centralized role/permission management

Works with middleware, Blade, and policies

Supports caching for performance

4. Quick Reference Table
Feature	Purpose	Example / Notes
auth	Check if user is logged in	middleware('auth')
guest	Check if user is not logged in	Redirects logged-in users
auth:sanctum	API token authentication	SPA / API token routes
role:<role>	Restrict route by role	Spatie middleware
permission:<permission>	Restrict route by permission	Spatie middleware
role_or_permission	Either role or permission	Flexible access control
Gates / Policies	Custom Laravel authorization	$user->can('update', $post)
5. Conceptual Flow – Middleware + Roles
[Request] 
   ↓
[Global Middleware (e.g., CORS)]
   ↓
[Authentication Middleware (auth / auth:sanctum)]
   ↓
[Role/Permission Middleware (Spatie)]
   ↓
[Controller / Route Logic]
   ↓
[Response]


✅ Quick Tips:

Apply auth middleware first, then role/permission middleware.

Use Spatie caching in production to speed up role/permission checks.

Middleware can be assigned globally, route-level, or controller-level.

Roles & permissions can also be checked programmatically via $user->hasRole(), $user->can().